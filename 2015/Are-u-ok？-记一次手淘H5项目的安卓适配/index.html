<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      colin - 愈之的个人博客
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="colin6618">
    
    

    <meta name="description" content="本文已授权发表于淘宝前端团队博客

¶Are u ok ?
当雷布斯很难和台下的印度佬语言沟通的时候，他不由自主地向台下的米粉呐喊Are u ok 抒发他不能讲中文却无比激动的情绪
当我看到那台老款安卓机上的H5页面的时候，我也想对它说 Are u ok?
我不是要卖给印度人手机，而是因为在这些低版本的安卓机面前我也常常词穷技穷。
¶问题背景
无线化风生水起呀，最近做的无线项目里有几个H5的网页，">
<meta property="og:type" content="article">
<meta property="og:title" content="Are u ok ？-- 记一次手机淘宝项目的适配经历 | 愈之 博客">
<meta property="og:url" content="https://ali996.com/2015/Are-u-ok？-记一次手淘H5项目的安卓适配/index.html">
<meta property="og:site_name" content="愈之 博客">
<meta property="og:description" content="本文已授权发表于淘宝前端团队博客

¶Are u ok ?
当雷布斯很难和台下的印度佬语言沟通的时候，他不由自主地向台下的米粉呐喊Are u ok 抒发他不能讲中文却无比激动的情绪
当我看到那台老款安卓机上的H5页面的时候，我也想对它说 Are u ok?
我不是要卖给印度人手机，而是因为在这些低版本的安卓机面前我也常常词穷技穷。
¶问题背景
无线化风生水起呀，最近做的无线项目里有几个H5的网页，">
<meta property="og:image" content="http://gtms02.alicdn.com/tps/i2/TB15IMmKXXXXXXzXpXX2AXZ8pXX-900-500.png">
<meta property="og:image" content="http://img2.tbcdn.cn/L1/461/1/9f4117125688c27b1a06ecdafe8019f37ac6ceb4">
<meta property="og:image" content="http://img3.tbcdn.cn/L1/461/1/7aa911ea32a8256f2bd91b4be7f5f01cc6b9058f">
<meta property="og:image" content="http://img2.tbcdn.cn/L1/461/1/5e1aeab961e13b61d4ccf56a09ca46295794bab4">
<meta property="og:image" content="http://img2.tbcdn.cn/L1/461/1/f07ed845db192f0f10e69dd1348c2d2fcc507c3f">
<meta property="og:image" content="http://img3.tbcdn.cn/L1/461/1/1747b910882969e04c7cb75d818d8433d4b4f67e">
<meta property="og:image" content="http://img1.tbcdn.cn/L1/461/1/e1eb474fa4ffe0c59f69ab2449c4a33bfc7d8e19">
<meta property="og:image" content="http://img2.tbcdn.cn/L1/461/1/6b948eedcc320cdc6751d2cc80d56e35f605e583">
<meta property="og:image" content="http://img4.tbcdn.cn/L1/461/1/60552e09f2786f09ae51a4382f15904dfbb796e8">
<meta property="og:updated_time" content="2018-05-30T02:33:21.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Are u ok ？-- 记一次手机淘宝项目的适配经历 | 愈之 博客">
<meta name="twitter:description" content="本文已授权发表于淘宝前端团队博客

¶Are u ok ?
当雷布斯很难和台下的印度佬语言沟通的时候，他不由自主地向台下的米粉呐喊Are u ok 抒发他不能讲中文却无比激动的情绪
当我看到那台老款安卓机上的H5页面的时候，我也想对它说 Are u ok?
我不是要卖给印度人手机，而是因为在这些低版本的安卓机面前我也常常词穷技穷。
¶问题背景
无线化风生水起呀，最近做的无线项目里有几个H5的网页，">
<meta name="twitter:image" content="http://gtms02.alicdn.com/tps/i2/TB15IMmKXXXXXXzXpXX2AXZ8pXX-900-500.png">

    
    
      <link rel="icon" type="image/x-icon" href="data:image/vnd.microsoft.icon;base64,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">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">
    
    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-43915292-2', 'auto');
      ga('send', 'pageview');
    </script>
    <!-- End Google Analytics -->
    
</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">愈之 博客</a></h1>
        <hr class="panel-cover__divider" />

        
        <p class="panel-cover__description">
          Colin&#39;s Blog, a breath of fresh air
        </p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">Blog</a></li>
              
                
                <li class="navigation__item"><a href="/about" title="" class="">About</a></li>
              
                
                <li class="navigation__item"><a href="/archive" title="" class="">Arch</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



<nav class="cover-navigation navigation--social">
  <ul class="navigation">

    
      <!-- Github -->
      <li class="navigation__item">
        <a href="http://colin6618.github.io/" title="Huno on GitHub">
          <i class='icon icon-social-github'></i>
          <span class="label">GitHub</span>
        </a>
      </li>
    

    <!-- China social icon -->
    <!--

      <li class="navigation__item">
        <a href="" title="">
          <i class='icon cs-icon-douban'></i>
          <span class="label">Douban</span>
        </a>
      </li>

      <li class="navigation__item">
        <a href="" title="">
          <i class='icon cs-icon-weibo'></i>
          <span class="label">Weibo</span>
        </a>
      </li>

    -->



  </ul>
</nav>




        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">Are u ok ？-- 记一次手机淘宝项目的适配经历</h1>

    

    <div class="post-meta">
      <time datetime="2015-05-07" class="post-meta__date date">2015-05-07</time> 

      <span class="post-meta__tags tags">

          

          
             &#8226; 标签:
            <font class="tags">
              <a class="tags-link" href="/tags/H5-适配-无线/">H5 适配 无线</a>
            </font>
          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <p><a href="http://www.taobaofed.org/blog/2015/10/28/auto-layout-in-h5-project/" target="_blank" rel="external">本文已授权发表于淘宝前端团队博客</a></p>
<p><img src="http://gtms02.alicdn.com/tps/i2/TB15IMmKXXXXXXzXpXX2AXZ8pXX-900-500.png" alt="h5"></p>
<h3 id="are-u-ok"><a class="header-anchor" href="#are-u-ok">¶</a>Are u ok ?</h3>
<p>当雷布斯很难和台下的印度佬语言沟通的时候，他不由自主地向台下的米粉呐喊Are u ok 抒发他不能讲中文却无比激动的情绪</p>
<p>当我看到那台老款安卓机上的H5页面的时候，我也想对它说 Are u ok?</p>
<p>我不是要卖给印度人手机，而是因为在这些低版本的安卓机面前我也常常词穷技穷。</p>
<h3 id="问题背景"><a class="header-anchor" href="#问题背景">¶</a>问题背景</h3>
<p>无线化风生水起呀，最近做的无线项目里有几个H5的网页，在大部分手机上表现得很正常，但是适配测试阶段测试提的一个问题：在中兴U930上，页面整体布局错乱。</p>
<p>眼看离提交手淘测试时间点越来越近了，PDPM测试问我能不能提交手淘啊，我只能说遗憾地说，“有一款手机上适配有问题，还要看看。”</p>
<p>因为这个适配问题让我很难办，不能审查DOM，定位只能靠猜和试。我说还要看看，真的是只能看看。</p>
<p>我问@顺堂，调试神器–<a href="http://mds.taobao.net/" target="_blank" rel="external">MDS调试平台</a>能不能调，顺堂居然羞涩地低下了头：安卓4.4以下的确实不行呢。因为devtool…（广告费你懂的）</p>
<p>PC端有坏孩子IE，到了移动端还有安卓系统碎片化的问题。世界太不和谐了。</p>
<h3 id="有图有真相"><a class="header-anchor" href="#有图有真相">¶</a>有图有真相</h3>
<p>一般情况下，H5页面显得很好很正常</p>
<p><img src="http://img2.tbcdn.cn/L1/461/1/9f4117125688c27b1a06ecdafe8019f37ac6ceb4" alt="图1"></p>
<p>而在中兴U930上是这样的。</p>
<p><img src="http://img3.tbcdn.cn/L1/461/1/7aa911ea32a8256f2bd91b4be7f5f01cc6b9058f" alt="图2"></p>
<p>丑的我都不好意思贴出来</p>
<h3 id="问题分析"><a class="header-anchor" href="#问题分析">¶</a>问题分析</h3>
<p>问题还是得解决的，没办法，只好从整个无线工程渲染和适配的过程开始想一遍了。</p>
<p>首先判断是浮动布局造成的影响，毕竟浮动布局容易引起的问题，于是将同行的元素全都改成成inline-block，重新布局后满心期待push，一看，问题依旧，该怎样还是怎样。</p>
<p>窗外天气不是很好，有点雾霾，要不把你这手机扔出去算了。-。-</p>
<p>从截图上看，原因可能是某个元素占据了整行，也有可能是文档流节点总宽度超出了容器宽度。</p>
<p>既然其他机型上宽度都是正常的，为什么唯独这款的宽度不正常呢？这个问题始终绕不过。因为到目前为止，始终还在样式布层面考虑。既然还是无法定位，说明仅仅考虑CSS可能无法找到问题根源或是线索了。</p>
<p>应该从现在项目依赖的平台和框架整个过一遍页面的适配和渲染过程。</p>
<h3 id="设备兼容"><a class="header-anchor" href="#设备兼容">¶</a>设备兼容</h3>
<p>我们的移动设备分辨率各式各样，视觉稿却是一个固定的大小。无线应用需要铺满整个屏幕，也就是自适应，和PC的不一样。那么我们的如何做到适应这么多分辨率呢？</p>
<p>还好我们有<a href="http://fed.taobao.net/" target="_blank" rel="external">kimi</a>提供的解决方案（真的不是广告）</p>
<p>无线kimi项目依赖于m-base, m-base通过设定根元素的rem，即通过HTML根元素相对长度单位来定义一个相对的基准单位，为什么说是相对的呢？因为这个基准单位的值在不同分辨率下是不同的。所以可能从m-base上能找到线索。</p>
<p>那么m-base的这个HTML根元素的font-size到底是如何计算出来的呢。</p>
<p>m-base从1.0.0开始，前端对rem的基准处理统一约定为：viewport/10，也等价于vw单位，后续的rem规范基准都以屏宽十分之一为准，和手淘首页新标准、天猫均保持一致。</p>
<p>也就是说，我们规定了
1rem = viewport / 10;
750的设计稿，1rem = 75px; 1px = 1/75 rem; 200px = 200 / 75 = 2.666666667rem;
640的设计稿，1rem = 64px; 1px = 1/64 rem; 200px = 200 / 64 = 3.125rem;</p>
<p><a href="http://gitlab.alibaba-inc.com/tbc/m-base/blob/master/1px.md" target="_blank" rel="external">更多资料可以看这里</a></p>
<h3 id="这个标题叫什么好呢"><a class="header-anchor" href="#这个标题叫什么好呢">¶</a>这个标题叫什么好呢</h3>
<p>分析到这就有点眉目了，可能是rem基准单位值设置大了;也可能是这设备对rem的计算不准确。第二点不在我们控制范围内。所以只考虑第一点：先查一下这个机型现在的1rem值和viewport宽度值，这个设备上只有祭出alert大法了。</p>
<p>** 打印meta 信息，打印viewport, document, device宽度信息**</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">var metas = window.parent.document.getElementsByTagName(&quot;meta&quot;)</div><div class="line">for (i = 0; i &lt; metas.length; i++) &#123;</div><div class="line">    alert(metas[i].getAttribute(&quot;name&quot;))</div><div class="line">    alert(metas[i].getAttribute(&quot;content&quot;))</div><div class="line">&#125;</div><div class="line"></div><div class="line">alert(/ZTE U930_TD/.test(navigator.userAgent));</div><div class="line">alert(document.documentElement.clientWidth);</div><div class="line">alert(document.body.clientWidth);</div><div class="line">alert(window.innerWidth);</div><div class="line">alert(window.pageXOffset);</div><div class="line">alert(window.outerWidth);</div><div class="line">alert(screen.width);</div><div class="line">alert(window.rem);</div></pre></td></tr></table></figure>
<p><strong>打印结果</strong></p>
<table>
<thead>
<tr>
<th>key</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr>
<td>document.documentElement.clientWidth</td>
<td>360</td>
</tr>
<tr>
<td>document.body.clientWidth</td>
<td>360</td>
</tr>
<tr>
<td>window.innerWidth</td>
<td>360</td>
</tr>
<tr>
<td>window.pageXOffset</td>
<td>360</td>
</tr>
<tr>
<td>window.outerWidth</td>
<td>540</td>
</tr>
<tr>
<td>screen.width</td>
<td>540</td>
</tr>
<tr>
<td>window.rem</td>
<td>40.67</td>
</tr>
</tbody>
</table>
<p>可以看到viewport宽度是360px，与该机型屏幕分辨率960x540相差了很大，这不科学啊~
<a href="http://detail.zol.com.cn/326/325040/param.shtml" target="_blank" rel="external">该机型的屏幕参数见这里</a></p>
<p>可以看到1rem=40.67px，这和预计的54px也不一样，而且也不是36px（viewport的1/10）。</p>
<p>奇怪，难道是该机型有推出过增强版或是乞丐版？而我手上的是乞丐版？于是去工信部网站查该设备。<a href="http://www.tenaa.com.cn/WSFW/LicenceShow.aspx?code=jpokusu3tlOFxUU4Lw2sNhOXuAZbYVdDfASF7DKgVYi6efm5qzmAAbUin3DJS6Mc" target="_blank" rel="external">工信部链接在这里</a>
似乎没有其他版本，但是意外看到了设备证书到期时间—本月10号就要到期了，哦呵呵。</p>
<h3 id="定位问题"><a class="header-anchor" href="#定位问题">¶</a>定位问题</h3>
<p>宽度我们改变不了，那么从基准rem着手。
为什么rem=40.67，按照设备信息算应该是54，按照实际的viewport算应该是36。</p>
<p>想不通，看m-base源码是怎么算的吧。
搜索gitlab代码库找到m-base，运气不错，很快就搜到了相关代码</p>
<p><img src="http://img2.tbcdn.cn/L1/461/1/5e1aeab961e13b61d4ccf56a09ca46295794bab4" alt="图3"></p>
<p>可以看到m-base对该机型做了特殊处理
40.678/1.13正好就是36，看来确实只有360px。</p>
<p>既然viewport就是360px，那么把rem设置为36px应该是正确的呀。
于是在项目代码里hack一段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">window.rem = document.documentElement.clientWidth / 10;</div><div class="line">var fontEl = document.createElement(&apos;style&apos;);</div><div class="line">fontEl.innerHTML = &apos;html: &#123;font-size:&apos; + window.rem + &apos;px !important&#125;&apos;;</div><div class="line">document.documentElement.firstElementChild.appendChild(fontEl);</div></pre></td></tr></table></figure>
<p>满心期待push后一看，没啥变化。打印window.rem，还是40.67。
应该是因为很多脚本在执行，无法保证在这一段代码在m-base后执行来获得更高的样式优先级，异步之殇啊。</p>
<p>那就粗暴一点直接设置标签属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">window.rem = document.documentElement.clientWidth / 10;</div><div class="line">$(&apos;html&apos;).attr(&apos;style&apos;, &apos;font-size: &apos; + window.rem + &apos;px !important&apos;);</div></pre></td></tr></table></figure>
<p>刷新页面果然生效了
<img src="http://img2.tbcdn.cn/L1/461/1/f07ed845db192f0f10e69dd1348c2d2fcc507c3f" alt="图4"></p>
<p>可以看到右边有一大片空白。
看来设备的真实viewport值大于360小于406.7，而rem大于36小于40.67。</p>
<p>到这里应该就算完全定位问题了。窗外雾霾似乎少了点，这手机也算捡回了条命。</p>
<h3 id="解决问题"><a class="header-anchor" href="#解决问题">¶</a>解决问题</h3>
<p>接下来就是是体力活了：采用折半搜索确定rem的准确值，算一次改一次刷新一次，尝试38.335太小39.5太小…试到大概40.06看上去差不多了</p>
<p>效果如图
<img src="http://img3.tbcdn.cn/L1/461/1/1747b910882969e04c7cb75d818d8433d4b4f67e" alt="screenshot"></p>
<p>已经很接近屏幕边缘了，问题修复到这其实可以算是fixed了</p>
<p>屏幕右边还是有一丝丝白边，对处女座不够友好。</p>
<p>但饭点都过了，手指刷的都不听话了。</p>
<p>可是我还想算的更精确。</p>
<blockquote>
<p>只要是重复的事情，肯定可以被程序取代。
— 我</p>
</blockquote>
<p>所以跑个任务吧</p>
<p>流程很简单</p>
<p><img src="http://img1.tbcdn.cn/L1/461/1/e1eb474fa4ffe0c59f69ab2449c4a33bfc7d8e19" alt="流程图"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">var adaptTheDevice = function (startRem) &#123;</div><div class="line">    window.rem = startRem || window.rem;</div><div class="line">    var _ss = $(&apos;#xiangsi-dianpu .sim-shop&apos;).first().find(&apos;.itemsinshop a&apos;);</div><div class="line">    var flag = true;</div><div class="line">    var stepping = 0.0001;</div><div class="line">    var time_in = new Date().getTime();</div><div class="line">    while (flag) &#123;</div><div class="line">        for (var i = 1; i &lt; _ss.length; ++i) &#123;</div><div class="line">            if (_ss[i].offsetTop &lt; 1) &#123;</div><div class="line">                flag = false;</div><div class="line">                alert(&apos;error&apos;)</div><div class="line">            &#125;</div><div class="line">            if (_ss[i - 1].offsetTop != _ss[i].offsetTop) &#123;</div><div class="line">                alert(window.rem - stepping);</div><div class="line">                flag = false;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        console.log(window.rem);</div><div class="line">        window.rem = window.rem + stepping;</div><div class="line">        $(&apos;html&apos;).attr(&apos;style&apos;, &apos;font-size: &apos; + window.rem + &apos;px !important&apos;);</div><div class="line">    &#125;</div><div class="line">    alert(&quot;used time: &quot; + (new Date().getTime() - time_in) + &quot; ms&quot;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p><strong>结果</strong></p>
<p><img src="http://img2.tbcdn.cn/L1/461/1/6b948eedcc320cdc6751d2cc80d56e35f605e583" alt="screenshot"></p>
<p><img src="http://img4.tbcdn.cn/L1/461/1/60552e09f2786f09ae51a4382f15904dfbb796e8" alt="screenshot"></p>
<p>好吧，只用了20s就跑下来了，适配的值定为40.076，以后再有丧心病狂的安卓4.0来袭就不用重复踩这个坑了，重跑一下这个任务就行了。</p>
<p>最后给m-base提个issue。</p>
<h3 id="后记"><a class="header-anchor" href="#后记">¶</a>后记</h3>
<p>解决这个问题一共花了等效时间约2人日，实际时间大约要一周。
据统计2014年每天都有约三部智能机上市，如果适配的单位是机器的话，现在市面上近共约四千部智能机每个型号都能测一遍吗？做得到吗？</p>
<p>更合理的适配单位应当是操作系统版本----以操作系统版本为适配标准的量尺，同时兼顾个别经典机型。</p>
<p>毕竟雷布斯都开口讲英文了，我们为什么不能改变呢？</p>

  </section>

  
  

  <div id="commentcontainer"></div>
  <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
  <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
  <script>
  var gitment = new Gitment({
    id: 'Thu May 07 2015 17:36:52 GMT+0800', // 可选。默认为 location.href
    owner: 'Colin6618',
    repo: 'bloggitment',
    oauth: {
      client_id: '7d308904155b6fd7a3b4',
      client_secret: '1682df4a07a1b324afbb93fdde3dfdb872872317',
    },
  })
  gitment.render('commentcontainer')
  </script>


</article>


            <footer class="footer">

    <span class="footer__copyright">&copy; 2014-2015. | 由<a href="https://hexo.io/">Hexo</a>强力驱动 | 主题<a href="https://github.com/someus/huno" rel="external nofollow">Huno</a></span>

</footer>

        </div>
    </div>

    <!-- js files -->
    <script src="https://cdn.bootcss.com/jquery/1.8.3/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>


    

    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            MathJax.Hub.Config({
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]}
            });
        });
    </script>



    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
